#include <iostream>
#include <unistd.h>

#include "IPlot.h"

#include "fcontrol.h"

using namespace std;


int main()
{

    double dts=0.01;

    IPlot pt(dts);


    TimeSignal dirac(valarray<double> {1, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
                ,dts);
    //fractional integrator FIR s^-0.857
    TimeSignal fi_085(valarray<double> {0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958,0.55171687002097958}
                ,dts);
    FSystemBlock c1(fi_085);

    SystemBlock motor(vector<double>{1, 1},
                      vector<double>{-1, 3},
                      1
                      );//simple integrator

    SystemBlock c2(vector<double>{168332,   -2616528,    -4348408,   4721072 ,   6499532},
                      vector<double>{861655,   3032620,   -7760070,   -6083380,    10247655},
                      1
                      );//simple integrator

    SystemBlock c2matlab(vector<double>{0.0164,   -0.2553,   -0.4242,    0.4607,    0.6343},
                      vector<double>{0.0841,    0.2959,   -0.7572,   -0.5936,    1.0000},
                      1
                      );//simple integrator
    double out;
    double target=100;
    double error=0;
    double show;

    for(double t=0;t<5;t+=dts)
    {


        //1-update inputs
        error = target - motor.GetState();

        //2-control diagram
        error  > c2matlab >  motor;

        //3-update outputs

        //3-update graphs and cout
        show=motor.GetState();
        pt.pushBack(show);

        cout << "t: " << t << ", plotdata: " << show << endl;
        sleep(dts);

    }

    pt.Plot();


    return 0;
}
